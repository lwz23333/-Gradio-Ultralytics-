# 《基于 Gradio 和 Ultralytics 的在线视频推理系统 模型分析报告（修订版）》

报告编号：CST4260-方案-2025-10  
完成团队：李文正、李自力、胡紫阳、刘同、龙正敖、李军、祝俊浩  
完成日期：2025-10-16

---

## 目录
1. 模型选择背景与需求口径
2. 开源模型与选型结论
3. 改进设计与实现细节
4. 性能评测与结果分析
5. 模型局限性量化分析
6. 改进方案与验证计划
7. 结论
8. 附录（代码片段、图表与数据说明）

---

## 1. 模型选择背景与需求口径
- 目标：构建高效、稳定、易用的实时目标检测系统，用于本地文件、摄像头和网络流（RTSP/RTMP/HTTP）。
- 统一指标口径：
  - 精度：mAP@0.5（如无特别说明），必要时补充 mAP@[0.5:0.95]
  - 实时性：FPS（1080P 输入，设备注明：如 RTX 3060），重复 3 次取均值
  - 资源：显存/内存占用（工具：nvidia-smi/psutil），记录峰值与稳态
  - 稳定性：连续运行 24h 的崩溃次数、FPS 波动（±%）与内存趋势

[图1 系统端到端架构图 占位：`docs/architecture.svg`]

---

## 2. 开源模型与选型结论
- 核心检测引擎：Ultralytics YOLOv11（型号：`yolo11n/s/m/l`）。
- 选型理由：
  - 实时性与精度平衡；API 完备、社区活跃；多型号适配不同资源约束。
- 结论（推荐）：
  - 在线实时：`yolo11n`（最佳速度/占用），`yolo11s`（平衡）
  - 离线高精度：`yolo11l`

[图2 模型族谱与规模-精度关系图 占位]

---

## 3. 改进设计与实现细节（系统级优化）
- 动态分辨率适配：4K 输入时自动降为 `imgsz=512/640`（策略需在实验中统一为一种，并在文末“口径变更记录”说明）。
- 流式推理：`stream=True`，逐帧处理并实时回传；OpenCV BGR → RGB 显示。
- 垃圾回收：每处理 100 帧触发 `gc.collect()`，缓解长稳内存缓增。
- 异常健壮性：对拉流中断、解码失败、模型切换增加 try/except 与重试。

[图3 推理数据流图：输入→预处理→YOLOv11→后处理→可视化/保存 占位]

---

## 4. 性能评测与结果分析
- 环境：Windows 11、Python 3.9、Torch 2.3.0+cu118、Ultralytics 8.3.13、OpenCV 4.9.0；硬件：i7-12700K / 32GB / RTX 3060(12GB)。
- 指标与方法：FPS（1080P）、mAP@0.5（COCO2017 验证集）、资源占用（稳态与峰值）。

[图4 不同模型 FPS/mAP 柱状图（cuda:0, 1080P）占位]

结论摘要：
- `yolo11n` 满足实时要求（FPS≥45），显存 < 2GB；`yolo11l` 精度更高但 FPS 较低，适合离线。
- CPU 推理 FPS≈18.5，难以满足实时；推荐 GPU 或引入加速（TensorRT/ONNX）。

[图5 硬件差异对比图（CPU/GPU）占位]

- 稳定性（24h）：无崩溃，FPS 下降约 2.5%，内存缓增 ~0.6GB。

[图6 24h 稳定性趋势图（FPS/内存/显存）占位]

---

## 5. 模型局限性量化分析
- 小目标：占画面 <5% 的目标召回下降（示例需给出类别/尺寸分布）。
- 低光/遮挡：夜间与强反光场景 mAP@0.5 下降 10%–15%。
- 公平性：类别/人群不平衡导致召回差异（建议补充分组报告）。

[图7 小目标尺寸直方图 与 分场景 mAP 表 占位]

---

## 6. 改进方案与验证计划
- 小目标：更换 `yolo11x`/RT-DETR 或加入超分预处理；验收：小目标 mAP@0.5 提升 ≥10%。
- CPU/边缘：ONNX Runtime/TensorRT，或帧抽样；验收：CPU 720P FPS ≥20。
- 公平性/低光：CLAHE 等增强；验收：夜间 mAP 下降 ≤5%，类别召回差异 ≤3%。

[图8 改进项效果双轴图（FPS↔mAP）占位]

---

## 7. 结论
`yolo11n` 在实时性与资源占用方面具备最佳综合表现；结合系统级优化后满足在线推理需求。建议根据场景选择型号，并按上节计划持续验证与迭代。

---

## 8. 附录
- 代码片段（节选）：
```python
import gc
from ultralytics import YOLO

def video_inference(src, model_name='yolo11n.pt', imgsz=640):
    model = YOLO(model_name)
    processed = 0
    for result in model.predict(src, imgsz=imgsz, stream=True):
        # TODO: 后处理与可视化
        processed += 1
        if processed % 100 == 0:
            gc.collect()
```
- 数据与图表文件：请将 CSV/PNG/SVG 放置于 `docs/`，并在上文图处引用。

---

### 口径变更记录
- 统一模型命名为 “YOLOv11”；模型文件沿用 `yolo11*.pt`。
- 统一 mAP 指标为 mAP@0.5（必要时补充 @0.5:0.95）。
- 分辨率自适应策略：统一示例为 `imgsz=640`（可在实验中切换为 512 并说明）。
